<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Visit Requests</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="./gen.js" type="module"></script>
</head>
<body class="bg-gray-100 min-h-screen flex">
  <!-- Sidebar -->
  <aside class="w-64 bg-white shadow-lg">
    <div class="px-6 py-4">
      <img src="../src/icons/RIBDEX.svg" style="width: 40px;">
    </div>
    <nav class="mt-8 space-y-4">
      <a href="./admin" class="flex items-center px-6 py-3 text-gray-700 hover:bg-indigo-100 hover:text-indigo-600">
        <span class="material-icons"><img src="../src/icons/216242_home_icon.svg"></span>
        <span class="ml-3">Properties</span>
      </a>
      <a href="#" class="flex items-center px-6 py-3 bg-indigo-100 text-indigo-600">
        <span class="material-icons"><img src="../src/icons/9004671_calendar_date_schedule_event_icon.svg"></span>
        <span class="ml-3">Visit Requests</span>
      </a>
      <a href="./orders.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-indigo-100 hover:text-indigo-600">
        <span class="material-icons"><img src="../src/icons/326700_cart_shopping_icon.svg"></span>
        <span class="ml-3">Reservations</span>
      </a>
    </nav>
  </aside>

  <!-- Main Content Area -->
  <div class="flex-1 flex flex-col">
    <!-- Header -->
    <header class="flex items-center justify-between px-6 py-4 bg-white shadow">
        <h1 class="text-xl font-semibold text-gray-700">Dashboard</h1>
        <div class="flex items-center space-x-4 cursor-pointer" id="signOutBtn">
          <img src="https://via.placeholder.com/40" alt="Profile Picture" class="w-10 h-10 rounded-full">
          <span class="text-gray-700" id="usernameDisp">User Name</span>
        </div>
      </header>

    <!-- Main Section -->
    <main class="p-6 space-y-6">
      <h2 class="text-2xl font-bold text-gray-700">Visit Requests</h2>

      <!-- Property Visit Requests -->
      <div class="space-y-8" id="visit-req">
        <!-- Property 1 Visit Requests -->
        <div class="bg-white p-4 rounded-lg shadow-lg">
          <h3 class="text-xl font-semibold text-gray-800">Property Title 1 - Visit Requests</h3>
          <ul class="mt-4 space-y-3">
            <li class="flex items-center justify-between p-3 bg-gray-100 rounded-lg">
              <span class="font-medium text-gray-800">John Doe</span>
              <span class="text-sm text-gray-600">johndoe@example.com</span>
              <span class="text-sm text-gray-600">+123456789</span>
              <span class="text-sm text-gray-600">Date Requested: Oct 15, 2024</span>
            </li>
            <li class="flex items-center justify-between p-3 bg-gray-100 rounded-lg">
              <span class="font-medium text-gray-800">Jane Smith</span>
              <span class="text-sm text-gray-600">janesmith@example.com</span>
              <span class="text-sm text-gray-600">+987654321</span>
              <span class="text-sm text-gray-600">Date Requested: Oct 16, 2024</span>
            </li>
          </ul>
        </div>

        <!-- Property 2 Visit Requests -->
        <div class="bg-white p-4 rounded-lg shadow-lg">
          <h3 class="text-xl font-semibold text-gray-800">Property Title 2 - Visit Requests</h3>
          <ul class="mt-4 space-y-3">
            <li class="flex items-center justify-between p-3 bg-gray-100 rounded-lg">
              <span class="font-medium text-gray-800">Alice Johnson</span>
              <span class="text-sm text-gray-600">alicej@example.com</span>
              <span class="text-sm text-gray-600">+456123789</span>
              <span class="text-sm text-gray-600">Date Requested: Oct 18, 2024</span>
            </li>
            <li class="flex items-center justify-between p-3 bg-gray-100 rounded-lg">
              <span class="font-medium text-gray-800">Bob Lee</span>
              <span class="text-sm text-gray-600">boblee@example.com</span>
              <span class="text-sm text-gray-600">+123789456</span>
              <span class="text-sm text-gray-600">Date Requested: Oct 20, 2024</span>
            </li>
          </ul>
        </div>
      </div>
    </main>
  </div>
</body>
<script type="module">
  // Import Firebase and Firestore functions
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  query,
  where,
} from "https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js";

// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyCWQ552it5NQwc7LCqlZ9LS2TPfYRv5S9w",
  authDomain: "real-ribdex-property.firebaseapp.com",
  projectId: "real-ribdex-property",
  storageBucket: "real-ribdex-property.firebasestorage.app",
  messagingSenderId: "634531624880",
  appId: "1:634531624880:web:872297c7bfa67dd7150875",
  databaseURL: "https://real-ribdex-property-default-rtdb.firebaseio.com",
};
// Import the functions you need from the SDKs you need
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Initialize Firebase
const app = initializeApp(firebaseConfig);
let propData = "";

import {
  getDatabase,
  ref as databaseRef,
  set,
  get,
  child,
  update,
  remove,
} from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js";

const propsCardContainer = document.querySelector("#visit-req");

// display proerty per object parsed
const dispProps = (objData) => {
  propsCardContainer.innerHTML = "";
  console.log("get ready");
  console.log(objData);
  for (const prop in objData) {
    console.log(objData[prop]);
    for (const estate in objData[prop]) {
      const property = objData[prop][estate];

      const card = document.createElement("div");
      card.classList.add("bg-white");
      card.classList.add("rounded-lg");
      card.classList.add("shadow-lg");
      card.classList.add("overflow-hidden");
      propsCardContainer.appendChild(card);

      const propImg = document.createElement("img");
      propImg.classList.add("w-full");
      propImg.classList.add("h-40");
      propImg.classList.add("object-cover");
      propImg.src = property.propertyImage;
      card.appendChild(propImg);

      const cardP = document.createElement("div");
      cardP.classList.add("p-4");
      card.appendChild(cardP);

      const propertyName = document.createElement("h3");
      propertyName.classList.add("text-lg");
      propertyName.classList.add("font-semibold");
      propertyName.classList.add("text-gray-800");
      propertyName.classList.add("h-[56px]");
      propertyName.textContent = estate;
      cardP.appendChild(propertyName);

      const propertyLocation = document.createElement("p");
      propertyLocation.classList.add("mt-1");
      propertyLocation.classList.add("text-sm");
      propertyLocation.classList.add("text-gray-600");
      propertyLocation.classList.add("h-[40px]");
      propertyLocation.textContent = property.propertyLocation;
      cardP.appendChild(propertyLocation);

      const propOrders = document.createElement("p");
      propOrders.classList.add("flex");
      propOrders.classList.add("items-center");
      propOrders.classList.add("justify-between");
      propOrders.classList.add("mt-3");
      cardP.appendChild(propOrders);

      const propertyPrice = document.createElement("span");
      propertyPrice.classList.add("text-indigo-600");
      propertyPrice.classList.add("font-bold");
      const formattedPrice = formatNumberWithCommas(property.priceNaira); // Format the price
      propertyPrice.textContent = "â‚¦" + formattedPrice;
      propOrders.appendChild(propertyPrice);

      const propertyFilled = document.createElement("span");
      propertyFilled.classList.add("text-green-600");
      propertyFilled.classList.add("font-bold");
      propertyFilled.textContent = property.formFilled + " fill submitted";
      propOrders.appendChild(propertyFilled);
    }
    console.log("done");
  }
};

function getpropIndv() {
  propsCardContainer.innerHTML = "";
  const database = getDatabase();
  const dataRef = databaseRef(database, "form/");

  get(dataRef)
    .then((snapshot) => {
      if (snapshot.exists()) {
        let propDatas = snapshot.val();
        console.log(propDatas);
        propData = propDatas;
        console,log(propData);
      } else {
        console.log("No data available");
      }
    })
    .catch((error) => {
      console.error(error);
    });
}
getpropIndv();


const typeHead = document.querySelector("#prop-types").children;
if (typeHead) {
  // Check if element exists
  Array.from(typeHead).forEach((typeEl) => {
    typeEl.addEventListener("click", () => {
      const typeName = typeEl.innerText;
      const typeProp = propData[typeName.toLowerCase()];
      const typeObj = {type: typeProp};
      dispProps(typeObj)
      
      // console.log({like: propData[typeName]})
    });
  });
} else {
  console.error("#prop-types element not found");
}

// format price to display with ',' - comma
function formatNumberWithCommas(number) {
  return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

</script>
</html>
